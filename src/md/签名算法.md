### 7、签名算法

为了保证商户传送到平台的参数信息不被恶意篡改， 网关为商户接口提供 Md5 加密摘要认证。  商户可用基础加密参数： 时间戳、 随机数、 签名密钥、 请求明文参数按指定顺序排列进行 Md5 加密并转化成大写， 产生一个验签串 sign，  商户请求网关接口时， 带上参数时间戳、 随机数、 请求明文参数、 sign 作为参数。 网关拿到相应的参数以同样的方式进行签名验签。 同理，  网关请求商户也以同样的方式进行身份验证。

```plain
sign=toUpperCase(md5(body + key + nonce + timestamp))
```

**PHP 代码示例** ：

```php
//应用的appkey
define("APPKEY","cbadf3d59e287036d5b71eba9af153f4");
//应用的appsecret
define("APPSECRET","XO8y4DQmPAx4BUoiBhi7KQ9CtApEFB61ymJQ4uspVJWQBJ766h53EFZUSyFsJbupfQwJYSvAtkeHuTbt");
//请求参数
$param['appkey']=APPKEY;
$param['symbl']="ETH";
$param['address']="0x7fd04f06581234d9bfc355a454d8f6692fe0de72";
ksort($param);
reset($param);
$arg="";
foreach($param as $key=>$val){
    $arg.=$key."=".$val."&";
}
//sign
$sign=strtoupper(md5(trim($arg,'&')."&key=".APPSECRET));
$jsonStr = json_encode($param)
```

**Golang 代码示例** ：

```typescript
APPSECRET := "XO8y4DQmPAx4BUoiBhi7KQ9CtApEFB61ymJQ4uspVJWQBJ766h53EFZUSyFsJbupfQwJYSvAtkeHuTbt"
data :=make(map[string]string)
data["appkey"] = "cbadf3d59e287036d5b71eba9af153f4"
data['symbl']="ETH";
data['address']="0x7fd04f06581234d9bfc355a454d8f6692fe0de72";
var multiple []string
for k := range data {
   multiple = append(multiple, k)
}
sort.Strings(multiple)
var buffer bytes.Buffer
for _, keys := range multiple {
   buffer.WriteString(keys)
   buffer.WriteString("=")
   buffer.WriteString(data[keys])
   buffer.WriteString("&")
}
joinstr := fmt.Sprintf("%skey=%s", buffer.String(), APPSECRET)
sign := strings.ToUpper(functions.Md5V(joinstr))
```

**Java 代码示例** ：

```typescript
final var APPSECRET = "XO8y4DQmPAx4BUoiBhi7KQ9CtApEFB61ymJQ4uspVJWQBJ766h53EFZUSyFsJbupfQwJYSvAtkeHuTbt";
final var data = new HashMap<String, String>();
data.put("appkey", "cbadf3d59e287036d5b71eba9af153f4");
data.put("symbl", "ETH");
data.put("'address'", "0x7fd04f06581234d9bfc355a454d8f6692fe0de72");
final var joinStr = new ArrayList<String>(data.keySet()).stream().sorted().map(key -> key + '=' + data.get(key)).collect(Collectors.joining("&"))
       + "&key=" + APPSECRET;
MessageDigest md = MessageDigest.getInstance("MD5");
md.update(joinStr.getBytes());
final var sign = new BigInteger(1, md.digest()).toString(16).toUpperCase(Locale.ROOT);
```

**Python 代码示例** ：

```typescript
import hashlib
import json
APPKEY = "cbadf3d59e287036d5b71eba9af153f4"
APPSECRET = "XO8y4DQmPAx4BUoiBhi7KQ9CtApEFB61ymJQ4uspVJWQBJ766h53EFZUSyFsJbupfQwJYSvAtkeHuTbt"
param = {
    "appkey":APPKEY,
    "symbbl":"ETH",
    "address":"0x123",
}
lists = list(param.keys())
lists.sort()
args = ""
for key in lists:
    args= args+key+"="+param[key]+"&"
url = args.strip("&")+"&key"+APPSECRET
sign = hashlib.md5(url.encode(encoding='UTF-8')).hexdigest().upper()
```
